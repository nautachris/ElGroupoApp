(function(n){function e(){this._defaults={format:"dHMS",Day:0,Month:0,Year:0,Hour:0,Min:0,Sec:0,expiryText:"Offer Expired",labels:["d","h","m","s"],timeSeparator:""}}n.countdown=new e;n.fn.countdown=function(t){return this.each(function(){n.countdown._attachCountdown(this,t)})};var t="countdown",i=0,r=1,u=2,f=3;n.extend(e.prototype,{_timer:setInterval(function(){n.countdown._updateTargets()},1e3),_timerTargets:[],_attachCountdown:function(i,r){var f=n(i),u={options:n.extend({},r),_periods:[0,0,0,0]};n.data(i,t,u);this._changeCountdown(i)},_changeCountdown:function(e,o){var s,h,c,l;o=o||{};s=n.data(e,t);s&&(s._until=new Date(s.options.Month+"/"+s.options.Day+"/"+s.options.Year+" "+s.options.Hour+":"+s.options.Min+":"+s.options.Sec+" "),h=this._get(s,"format"),c=[],c[i]=h.match("d")?"?":h.match("D")?"!":null,c[r]=h.match("h")?"?":h.match("H")?"!":null,c[u]=h.match("m")?"?":h.match("M")?"!":null,c[f]=h.match("s")?"?":h.match("S")?"!":null,s._show=c,n.data(e,t,s),l=this._UTCDate(),s._until&&s._until>l&&(this._hasTarget(e)||this._timerTargets.push(e)),this._updateCountdown(e,s))},_updateCountdown:function(i,r){var f=n(i),u;(r=r||n.data(i,t),r)&&(f.html(this._generateHTML(r)),u=r._now.getTime()>=r._until.getTime(),u&&!r._expiring&&(r._expiring=!0,this._hasTarget(i)&&this._removeTarget(i),r.options.Expired=!0,this._updateCountdown(i,r),r._expiring=!1),n.data(i,t,r))},_hasTarget:function(t){return n.inArray(t,this._timerTargets)>-1},_removeTarget:function(t){this._timerTargets=n.map(this._timerTargets,function(n){return n==t?null:n})},_updateTargets:function(){for(var n=this._timerTargets.length-1;n>=0;n--)this._updateCountdown(this._timerTargets[n])},_get:function(t,i){return t.options[i]!=null?t.options[i]:n.countdown._defaults[i]},_UTCDate:function(){var n=new Date,t=n.getHours()+n.getTimezoneOffset()/60;return n.setHours(t,n.getMinutes(),n.getSeconds(),n.getMilliseconds()),n},_generateHTML:function(n){n._periods=this._calculatePeriods(n,n._show,this._UTCDate());var e=this._get(n,"timeSeparator"),o=this._get(n,"labels"),t=function(t,i){return'<span class="countdown_data">'+n._periods[t]+o[t]+" "+(i?e:"")+" <\/span>"};return n.options.Expired==!0?'<span class="countdown_section"><span class="countdown_data">'+this._get(n,"expiryText")+"<\/span><\/span>":'<span class="countdown_section">'+t(i,!0)+t(r,!0)+t(u,!0)+t(f,!1)+"<\/span>"},_calculatePeriods:function(n,t,e){var o;n._now=e;n._now.setMilliseconds(0);o=new Date(n._now.getTime());o.setTime(n._until.getTime());e.getTime()>n._until.getTime()&&(n._now=e=o);var h=[0,0,0,0],c=Math.floor((o.getTime()-e.getTime())/1e3),s=function(n,i){h[n]=t[n]?Math.floor(c/i):0;c-=h[n]*i};return s(i,86400),s(r,3600),s(u,60),s(f,1),h}})})(jQuery),function(n){"use strict";UA.Utilities.namespace("UA.Booking.Confirmation");UA.Booking.Confirmation=function(){return{el:n("#BP-confirmation"),elements:{},selectorAirportPassengerDutyTrigger:'[data-toggle="tooltip-airport-passenger-duty"]',selectorAirportPassengerDutyContent:"#airportpassenger-duty",init:function(){this.bindEvents();this.initExpCol();this.initTaxesFeesToolTip();this.initSpecialTaxesFeesToolTip();this.displayFareLockCounter();this.getProducts();this.initFlightBlock();this.initCurrencyConversionTooltip();this.initAirportPassengerDutyTip();this.disableBackButton();n("#savedTrips").val()==="True"&&UA.Common.SavedTrips.removeDataFromLocalStorage(n("#CartId").val())},disableBackButton:function(){n("#hdnBackButtonOnConfirmation").val()==="True"&&(history.pushState(null,null,""),window.addEventListener("popstate",function(){history.pushState(null,null,"")}))},bindEvents:function(){var i=this,t=n(document);t.on("click","#emailItinerary",n.proxy(this.showShareItineraryModal,this));t.on("submit",".modal-share-itinerary-shared form",n.proxy(this.handleShareSubmit,this));t.on("mouseenter click",".segment-advisories",this.handleAdvisoriesTooltip);t.on("mouseenter",".upgrade-eligible",n.proxy(this.handleUpgradeEligibleTooltip,this));t.on("mouseenter",".upgrade-not-eligible",n.proxy(this.handleUpgradeNotEligibleTooltip,this));t.on("mouseenter",".upgrade-available",n.proxy(this.handleUpgradeAvailableTooltip,this));t.on("mouseenter",".upgrade-waitlist",n.proxy(this.handleUpgradeWaitlistTooltip,this));t.on("click",".simplemodal-close",n.proxy(this.handleModalPopupClose,this));t.on("click","#btnLiteEnroll",n.proxy(this.handleLiteEnrollment,this))},handleModalPopupClose:function(){n.modal.close()},showShareItineraryModal:function(t){t.preventDefault();n("#modal-share-itinerary").modal({overlayClose:!0,onShow:function(n){n.container.addClass("modal-share-itinerary-shared")}});UA.UI.InFieldLabel.init(null,null,"#modal-share-itinerary")},initExpCol:function(){n("#PremierAccess, #awardaccelerator, #premieraccelerator, #CabinUpgrade, #economyplus, #standardeconomy, #InCabinPet, #BundlesEPE, #BundlesEPS, #taxHeader, #BundlesBE").click(function(){n(this).find(".summary-dropdown").toggleClass("summary-dropdown-expand")});n("#PremierAccess, #awardaccelerator, #premieraccelerator, #CabinUpgrade, #economyplus, #standardeconomy, #InCabinPet, #BundlesEPE, #BundlesEPS, #taxHeader, #BundlesBE").keydown(function(){n(this).attr("aria-expanded")==="false"&&n(this).find(".summary-dropdown").hasClass("summary-dropdown-expand")&&n(this).find(".summary-dropdown").removeClass("summary-dropdown-expand");n(this).attr("aria-expanded")!=="true"||n(this).find(".summary-dropdown").hasClass("summary-dropdown-expand")||n(this).find(".summary-dropdown").addClass("summary-dropdown-expand")});n(".expCol-tax").accordion({animate:!1,collapsible:!0,active:!1,heightStyle:"content",autoHeight:!1,disabled:!0,icons:{header:"icon-toggle-arrow-right-gray",activeHeader:"icon-toggle-arrow-down-gray"}});n("#tax-breakdown-confirmation h3.ui-accordion-header").click(function(){n(this).next().slideToggle();n(this).find(".ui-accordion-header-icon").toggleClass("icon-toggle-arrow-down-gray")});n("#tax-breakdown-confirmation h3.ui-accordion-header").keypress(function(n){if(n.which===13)return this.click(),!1});n(".bundles-description-collapsible").click(function(){n(".bundle-total",this).toggle()})},handleFlightBlockTabsBeforeActivate:function(n,t){var i=t.newTab.length?t.newTab:t.oldTab,r=i.closest(".flight-block");r.toggleClass("flight-block-expanded",t.newTab.length!=0)},initFlightBlock:function(t){var i=this;n.widget("ui.tabs",n.ui.tabs,{_getList:function(){var n=null;return this.options.tabList&&(n=this.options.tabList),n||this._super()}});n.each(t||n(".flight-block"),function(t,r){var u=n(r);UA.UI.Tabs.init(u.find(".flight-block-details-container"),{tabList:u.find(".flight-block-tab-list"),collapsible:!0,active:!1,beforeActivate:n.proxy(i.handleFlightBlockTabsBeforeActivate,i)})})},getProducts:function(){var t,i=this,u={CartId:n("#CartId").val(),ProductCode:"STI"},f=location.pathname.toLowerCase().replace("/default","")+"/products",e=n("#ConfirmProducts"),r=e.find(".panel-body");t=n.ajax({url:f,type:"POST",data:JSON.stringify(u),contentType:"application/json; charset=utf-8",dataType:"html",beforeSend:function(){i.spinner=r.loader()}});t.done(function(t){i.spinner.loader("destroy");var u=n(t.trim()).appendTo(r);UA.UI.processModule(u)})},handleShareSubmit:function(t){var i=n(".modal-share-itinerary-shared form"),e,u,o,f,r;return i.length===0||!i.valid()?!1:(e=i.attr("action"),u=n(i).find("#btnShare").loader({preset:"btnTile"}),o=n(i).serialize(),t.preventDefault(),f=n.ajax({url:e,type:"POST",data:o,dataType:"json"}),f.success(function(t){t.Error?(console.log(t.Error),u.loader("destroy")):(r=n(t.Html),r.find(".itinerary-form").hide(),r.find(".itinerary-detail").show(),n("#simplemodal-container").css("height","auto"),n(".modal-share-itinerary-shared .modal-share-itinerary").html(r.children()))}),f.error(function(){u.loader("destroy");n.modal.close()}),!1)},displayFareLockCounter:function(){var t,i=n("#FLCountdown"),r=i.length>0?i.data("count-down"):null;return r&&!r.IsDeleted&&(t=new Date(r.ExpirationDate),i.countdown({Month:t.getMonth()+1,Day:t.getDate(),Year:t.getFullYear(),Hour:t.getHours(),Min:t.getMinutes(),Sec:t.getSeconds()})),!1},initCurrencyConversionTooltip:function(){if(n("#UsedMultipleCurrencies").val()=="True"&&n("#InternationalFareCurrency").length>0&&n("#InternationalFareCurrency").val()!=""){var t=n("#bookingCart").val(),i={targetCurrency:n("#InternationalFareCurrency").val(),totalFareAmount:n("#TotalFareAmount").val(),cartId:t},r=n(".tip-cart-msg").data("url-currency-conversion");n.ajax({url:r,type:"POST",cache:!1,data:i,dataType:"json",success:function(t){t!=null&&(n("#currency-conversion").html(t.currencyConversionFormattedStr),n("#fare-typedescription").html(n("#TypeDescription").val()),n("#cart-tool-tip").addClass("icon-tooltip-large-clear-bg tool-tip-cart-msg float-right clear-both"),t.totalfareamountstr!=""&&n("#total-Fare-Amount").html(t.totalfareamountstr),n("#valid-date").html(t.validDate),n("#cart-tool-tip").hover(function(){n(".tip-cart-msg").show()},function(){n(".tip-cart-msg").hide()}),n(".icon-cart-msg-close").click(function(){n(".tip-cart-msg").hide()}),n("#fare-typedescription").html(n("#TypeDescription").val()),t.totalTargetPriceFormattedstr!=""&&n("#valid-formatted-fare").html(t.totalTargetPriceFormattedstr))}})}},initTaxesFeesToolTip:function(){UA.UI.Tooltip.init("#purchSumTF",{content:{text:n("#tax-breakdown-confirmation").clone(!0)},position:{my:"top left",at:"bottom left",adjust:{method:"shift none",effect:!1},viewport:!0},show:"click",hide:"click unfocus"},"close")},initSpecialTaxesFeesToolTip:function(){UA.UI.Tooltip.init(n(".special-travel-fee",this.element),{content:{text:n("#special-travel-fee")},position:{my:"top left",at:"bottom left",adjust:{method:"shift none",effect:!1},viewport:!0},show:"click",hide:"click unfocus"},"close")},handleUpgradeWaitlistTooltip:function(t){n(t.currentTarget).qtip({overwrite:!1,content:{text:n("#tooltip-fare-upgrade-waitlist").clone()},show:{event:t.type,ready:!0},position:{at:"top center",my:"bottom center",viewport:!0,target:"event"},style:{classes:"tip-united",tip:{width:14,height:7,mimic:"center"}},events:{hide:function(n,t){t.destroy()}}},t)},handleUpgradeAvailableTooltip:function(t){n(t.currentTarget).qtip({overwrite:!1,content:{text:n("#tooltip-fare-upgrade-available").clone()},show:{event:t.type,ready:!0},position:{at:"top center",my:"bottom center",viewport:!0,target:"event"},style:{classes:"tip-united",tip:{width:14,height:7,mimic:"center"}},events:{hide:function(n,t){t.destroy()}}},t)},handleUpgradeEligibleTooltip:function(t){n(t.currentTarget).qtip({overwrite:!1,content:{text:n("#tooltip-fare-upgrade-eligible").clone()},show:{event:t.type,ready:!0},position:{at:"top center",my:"bottom center",viewport:!0,target:"event"},style:{classes:"tip-united",tip:{width:14,height:7,mimic:"center"}},events:{hide:function(n,t){t.destroy()}}},t)},handleUpgradeNotEligibleTooltip:function(t){n(t.currentTarget).qtip({overwrite:!1,content:{text:n("#tooltip-fare-upgrade-not-eligible").clone()},show:{event:t.type,ready:!0},position:{at:"top center",my:"bottom center",viewport:!0,target:"event"},style:{classes:"tip-united",tip:{width:14,height:7,mimic:"center"}},events:{hide:function(n,t){t.destroy()}}},t)},initAirportPassengerDutyTip:function(){UA.UI.Tooltip.init(this.selectorAirportPassengerDutyTrigger,{content:{text:n(this.selectorAirportPassengerDutyContent).clone(!0)},position:{my:"top left",at:"bottom left",adjust:{method:"shift none",effect:!1}}},"close")},handleAdvisoriesTooltip:function(t){t.preventDefault();var i=this;UA.UI.Tooltip.init(n(t.currentTarget),{content:{text:""},show:{event:t.type,ready:!0},position:{target:"event",effect:!1},events:{show:function(t,r){r.set("content.text",n(i).next().clone())}}},"default-delegated",null,!1,t)},handleLiteEnrollment:function(t){var i=n("#enrollProfileForm");return i.length===0||!i.valid()?!1:(t.preventDefault(),n("#btnLiteEnroll").prop("disabled",!0),this.spinner=n(t.currentTarget).loader({preset:"btnLiteEnroll"}),n("#enrollProfileForm").submit(),!1)}}}();n(document).ready(function(){UA.Booking.Confirmation.init()})}(jQuery),function(n){"use strict";UA.Utilities.namespace("UA.Booking.Confirmation.Upsell");UA.Booking.Confirmation.Upsell=function(){function f(n){var t=n.validate();return n.valid()?!0:(t.focusInvalid(),!1)}function e(){var r=n(this).find("option:selected"),u=n("#billingInfoPcuForm"),t,f,e,o,s,i;r.length<=0||(t=n(r).data("card"),n("#PurchaseSummary_PcuBillingInfo_Selected_GroupId").val(t.GroupId),n("#PurchaseSummary_PcuBillingInfo_Selected_Index").val(t.Index),n("#PurchaseSummary_PcuBillingInfo_Selected_CreditCardKey").val(t.CreditCardKey),n("#PurchaseSummary_PcuBillingInfo_Selected_IsSaveCardToAccount").val(t.IsSaveCardToAccount),n("#PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode").val(t.CardTypeCode),n("#PurchaseSummary_PcuBillingInfo_Selected_CardNumber").val(t.CardNumber),t.ExpMonth==="0"&&(t.ExpMonth=""),n("#PurchaseSummary_PcuBillingInfo_Selected_ExpMonth").val(t.ExpMonth),t.ExpYear==="0"&&(t.ExpYear=""),n("#PurchaseSummary_PcuBillingInfo_Selected_ExpYear").val(t.ExpYear),n("#PurchaseSummary_PcuBillingInfo_Selected_SecurityCode").val(t.SecurityCode),n("#PurchaseSummary_PcuBillingInfo_Selected_CardHolderName").val(t.CardHolderName),n("#PurchaseSummary_PcuBillingInfo_Selected_AddressLine1").val(t.AddressLine1),n("#PurchaseSummary_PcuBillingInfo_Selected_AddressLine2").val(t.AddressLine2),n("#PurchaseSummary_PcuBillingInfo_Selected_AddressLine3").val(t.AddressLine3),n("#PurchaseSummary_PcuBillingInfo_Selected_City").val(t.City),n("#PurchaseSummary_PcuBillingInfo_Selected_StateCode").val(t.StateCode),n("#PurchaseSummary_PcuBillingInfo_Selected_PostalCode").val(t.PostalCode),i=n("#PurchaseSummary_PcuBillingInfo_Selected_CountryCode").val(),t.CountryCode=i!=""?i:"US",n("#PurchaseSummary_PcuBillingInfo_Selected_CountryCode").val(t.CountryCode),t.CardNumber?(n("#BillingInfo").hide(),f=n("#selected-card-template").html(),e=Handlebars.compile(f),n(".card-info-container").html(e(t)),n(".card-info-container").show(),o=n("#selected-address-template").html(),s=Handlebars.compile(o),n(".section-saved-address").html(s(t)),n(".section-saved-address").show()):(u.find("input").blur(),u.find("select").uniform().each(UA.UI.Uniform.moveInFieldLabelElements).change().blur(),n(".card-info-container").hide(),n(".section-saved-address").hide(),n("#BillingInfo").show()))}var i="PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode",u="savedCards",t,r=0;return{templates:{},init:function(){t=n(".modal-upsell-body");this.bindEvents();this.getPcu()},showUpsellModal:function(){n.modal.close();var i,t=n(".modal-upsell");t.length>0&&(i=t.data("dialog-container-class"),t.modal({persist:!0,position:[20],onShow:function(t){t.container.css({"overflow-x":"hidden","overflow-y":"scroll",height:"95vh"});n("body").css("overflow","hidden");n("#IsPCUModalChange").val()=="True"&&n(".modalCloseImg",t.container).addClass("modalCloseImgBlack")},onClose:function(){n.modal.close();n("body").css("overflow","inherit")},containerClass:"modal-pcu-select "+i}))},getPcu:function(){var u,e={cartId:n("#CartId").val(),pnr:n(".confirm-number").val()},o=location.pathname.toLowerCase().replace("/default","")+"/GetPcu",s=n("#PcuProducts"),r=this,h=n("#isPcuPurchased").val(),c=n("#skipPcuModalWindow").val(),f;h!="True"&&c!="True"&&(u=n.ajax({url:o,type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"html",suppressGlobalErrorMessage:!0}),u.done(function(u){var e,o;u!=null&&(e=JSON.parse(u),e.IsPcuEligible&&(o=s.html(e.PcuOffersHtml.trim()),t=n(".modal-upsell-body"),r.countChecked(),f=n("#"+i).val(),r.processCreditCardMessaging(f),r.processCreditCardSecurityCode("PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode","divPcuCreditCardSecurityCode",!1),r.showUpsellModal(),UA.UI.reInit(t),UA.UI.processModule(o)))}).fail(function(n,t){UA.Utilities.logError(t)}))},handleEditClick:function(t){t.preventDefault();var i=n(t.currentTarget);this.collapseAllPanels();i.closest(".panel").addClass("panel-active");n("#CreditCardInfo").show();n("#divPurchaseButtons").toggle(!i.hasClass("stepped"))},handlePaymentEditClick:function(t){t.preventDefault();var i=n(t.currentTarget);this.collapseAllPanels();i.closest(".panel").addClass("panel-active");n("#CreditCardInfo, #divPurchaseButtons").show();n(".panel-heading, .panel-body-paymentmethod").attr("tabindex","-1").focus()},collapseAllPanels:function(){t.find(".panel").removeClass("panel-active")},handleSecurtyCodeToolTip:function(t){UA.UI.Tooltip.init(n(t.currentTarget),{content:{text:function(){return n(this).next(".tip-security-code").clone()}},show:{event:t.type,ready:!0}},"default-delegated",null,!1,t)},disablePcuUpgradeButtons:function(){this.checkoutSpinner=n("#btnUpsellCheckout").loader({preset:"btnTile"});this.setPcuUpgradeButtonState(!0)},enablePcuUpgradeButtons:function(){this.checkoutSpinner.data("ua-loader")&&this.checkoutSpinner.loader("destroy");this.setPcuUpgradeButtonState(!1)},setPcuUpgradeButtonState:function(t){n("#btnUpsellCheckout, #btnNoThanks").prop("disabled",t)},disableCheckBox:function(){n(".panel-body-trips").find(".segment input").each(function(){n(this).prop("disabled",!0)})},enablecheckBox:function(){n(".panel-body-trips").find(".segment input").each(function(){n(this).prop("disabled",!1)})},processSubmit:function(){var t=this,i=n("#billingInfoPcuForm");this.disableCheckBox();n("#PurchaseSummary_PcuBillingInfo_Selected_CardNumber").val("");var u=i.serialize(),f=i.attr("action"),e=n.ajax({url:f,type:"post",data:u,error:function(){t.enablePcuUpgradeButtons();t.enablecheckBox()}});e.done(function(u){if(u.ErrorDict){var f=i.validate();f.showErrors(u.ErrorDict);t.enablecheckBox();t.enablePcuUpgradeButtons();n(".modal-upsell .global-error-placeholder").show()}else u.ErrorMessage?u.IsFOPError==!0?(r=r+1,r>=u.ErrorThreshold?n.modal.close():(n(".modal-upsell .global-error-wrapper").html(u.ErrorMessage),n("#pUpgradeNowMessage, #divPurchaseButtons, .modal-upsell .global-error-placeholder").show(),n("#divSegmentsButtons").hide(),i.valid(),t.enablePcuUpgradeButtons(),t.enablecheckBox()),n("#pcu_purchase_err").show()):(n(".global-error-wrapper").html(u.ErrorMessage),n.modal.close(),n("#pcu_purchase_err").show()):u.RedirectUrl&&(n("#pcu_purchase_err").hide(),window.location.href=u.RedirectUrl)}).fail(function(n,i){t.enablePcuUpgradeButtons();t.enablecheckBox();UA.Utilities.logError(i)})},handleCheckout:function(t){t.preventDefault();var o=n(".panel-body-trips").find(".segment input:checked").length,r=this,u,e,i;if(o<=0)return n(".select-flight-error-placeholder").show(),n(".modal-upsell-body .panel-trips .panel-edit-trigger").click(),!1;if(u=f(n("#billingInfoPcuForm")),u)r.disablePcuUpgradeButtons(),n(".modal-upsell .global-error-placeholder").hide(),e=n("#PurchaseSummary_PcuBillingInfo_Selected_CardNumber").val(),i={Key:"1",CardTypeCode:n("#PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode").val(),EncryptedCardNumber:n("#PurchaseSummary_PcuBillingInfo_Selected_EncryptedCardNumber").val(),ExpMonth:n("#PurchaseSummary_PcuBillingInfo_Selected_ExpMonth").val(),ExpYear:n("#PurchaseSummary_PcuBillingInfo_Selected_ExpYear").val(),SecurityCode:n("#PurchaseSummary_PcuBillingInfo_Selected_SecurityCode").val(),CardHolderName:n("#PurchaseSummary_PcuBillingInfo_Selected_CardHolderName").val(),CreditCardKey:n("#PurchaseSummary_PcuBillingInfo_Selected_CreditCardKey").val(),CartId:n("#CartId").val(),GroupId:n("#PurchaseSummary_PcuBillingInfo_Selected_GroupId").val(),IsPcu:!0},n("#savedCards").val()==="Add New"?n.when(UA.Utilities.generateHash(n("#billingInfoPcuForm").data("randomhash"))).done(function(t){var u=UA.Utilities.encrypt(t,e);i.EncryptedCardNumber=u;n("#PurchaseSummary_PcuBillingInfo_Selected_EncryptedCardNumber").val(i.EncryptedCardNumber);r.lookup3ds(i)}):r.lookup3ds(i);else return},lookup3ds:function(t){var r=n("#btnUpsellCheckout").data("url-threeds"),i=this,u=n.ajax({url:r,type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",error:function(){i.enablePcuUpgradeButtons()}});u.done(function(t){var r=n("#redirectForm");r.attr("action",t.AcsUrl);r.children("input[name=PaReq]").attr("value",t.PaReq);r.children("input[name=TermUrl]").attr("value",t.RetUrl);r.children("input[name=MD]").attr("value",t.CardIndex);n("#PurchaseSummary_PcuBillingInfo_Selected_ErrorType").val(t.ErrorType);n("#PurchaseSummary_PcuBillingInfo_Selected_ErrorNumber").val(t.ErrorNumber);t.CardIndex.length>0&&n("#PurchaseSummary_PcuBillingInfo_Selected_GroupId").val(t.CardIndex);t.Error?(i.processSubmit(),UA.Utilities.logError(t.Error)):t.IsEnrolled?(window.parent.closeModal=function(){n.modal.close();i.showUpsellModal();i.processSubmit()},n.modal.close(),n("#iframe3dsTarget").modal(),r.submit()):(i.processSubmit(),UA.Utilities.log("No 3ds enrollment, submitting"))}).fail(function(n,t){i.processSubmit();UA.Utilities.logError("3Ds FAILED!!!"+t)})},processCreditCardMessaging:function(t){var i=!1;!0&&(t==="VI"?(n(".visa-msg").show(),n(".MC-msg").hide(),i=!0):t==="MC"&&(n(".MC-msg").show(),n(".visa-msg").hide(),i=!0),n("#PurchaseSummary_PcuBillingInfo_Selected_CardNumber").attr("maxlength","20"),UA.AppData.Data.Session.IsSignedIn&&(n("#divSaveCardToAccountMessageUP").hide(),n("#PurchaseSummary_PcuBillingInfo_Selected_IsSaveCardToAccount").removeAttr("disabled","false"),n("#uniform-PurchaseSummary_PcuBillingInfo_Selected_IsSaveCardToAccount").removeAttr("disabled","false"),t=="UP"&&(n("#PurchaseSummary_PcuBillingInfo_Selected_CardNumber").attr("maxlength","16"),n("input:checkbox[id=PurchaseSummary_PcuBillingInfo_Selected_CardNumber][value=false]").prop("checked",!1),n("#uniform-PurchaseSummary_PcuBillingInfo_Selected_IsSaveCardToAccount span").removeClass("checked"),n("#PurchaseSummary_PcuBillingInfo_Selected_IsSaveCardToAccount").attr("disabled","true"),n("#divSaveCardToAccountMessageUP").show())));i||(n(".visa-msg").hide(),n(".MC-msg").hide())},processCreditCardSecurityCode:function(t,r,u){var o=!0,f=n("#"+t).val(),e=UA.Booking.Confirmation.Upsell.selectedCardType,s;typeof f=="undefined"&&(f=n("#hdnCardType").val());f!=e&&n("#"+i).val(e);r=n("#"+r);u&&(s=n("input:radio[name=FOPOption]:checked").val(),s!=="CreditCard"&&(o=!1));o?f!==""?f=="JC"||f=="DC"||f=="TP"||e=="TP"?r.hide():f==="VI"?(r.show(),n(".tip-security-code-default, .tip-security-code-mc, .tip-security-code-discover, .tip-security-code-amex, .tip-security-code-unionpay").hide(),n(".tip-security-code-visa").show()):f==="MC"?(r.show(),n(".tip-security-code-default, .tip-security-code-visa, .tip-security-code-discover, .tip-security-code-amex, .tip-security-code-unionpay").hide(),n(".tip-security-code-mc").show()):f==="AX"?(r.show(),n(".tip-security-code-default, .tip-security-code-visa, .tip-security-code-discover, .tip-security-code-mc, .tip-security-code-unionpay").hide(),n(".tip-security-code-amex").show()):f==="DS"?(r.show(),n(".tip-security-code-default, .tip-security-code-visa, .tip-security-code-amex, .tip-security-code-mc, .tip-security-code-unionpay").hide(),n(".tip-security-code-discover").show()):f==="UP"&&(r.show(),n(".tip-security-code-default, .tip-security-code-visa, .tip-security-code-amex, .tip-security-code-mc, .tip-security-code-discover").hide(),n(".tip-security-code-unionpay").show()):(r.show(),n(".tip-security-code-default").show(),n(".tip-security-code-discover, .tip-security-code-visa, .tip-security-code-amex, .tip-security-code-mc, .tip-security-code-unionpay").hide()):r.hide()},handleAddCardClick:function(t){t.preventDefault();n("#savedCards")[0].selectedIndex=0;n("#savedCards").uniform();n("#savedCards").change();n("#BillingInfo").attr({tabindex:"-1","aria-atomic":"true"}).focus()},handleNextClick:function(i){i.preventDefault();var r=n(".panel-body-trips").find(".segment input:checked").length;r<=0?n(".select-flight-error-placeholder").show():(this.collapseAllPanels(),t.find(".panel-payment-infos").addClass("panel-active"),n("#CreditCardInfo, #divPurchaseButtons").show())},countChecked:function(t){var i,f,r,e,u;n(".select-flight-error-placeholder").hide();t&&t.currentTarget&&(i=n(t.currentTarget),f=i.is(":checked"),r=i.data("url-add"),f||(r=i.data("url-remove")),r&&(e=n.ajax({url:r,type:"GET",dataType:"html"})));u=n(".panel-body-trips").find("input:checked").length;n("#upsell-segment-count").text(u);u>0?n("#upsell-segment-count-message").show():n("#upsell-segment-count-message").hide();n("#btnNextPanel").prop("disabled",u<=0);this.calculateTotal()},calculateTotal:function(){var r=n(".panel-body-trips").find(".segment input:checked"),t=0,u=n(".panel-body-trips").find(".segment input").data("pcu-currency"),i;n(r).each(function(){var i=parseFloat(n(this).data("pcu-amount"),10);isNaN(i)||(t=t+i)});i=UA.Utilities.formatting.formatMoney(t,u);n("#PcuTotal").text(i)},bindEvents:function(){var t=n(document),r=this;t.on("click",".modal-upsell-body #tripsEdit",n.proxy(this.handleEditClick,this));t.on("click",".modal-upsell-body #paymentEdit",n.proxy(this.handlePaymentEditClick,this));t.on("click",".modal-upsell-body #btnNextPanel",n.proxy(this.handleNextClick,this));t.on("change","#savedCards",e);t.on("click","#btnUpsellCheckout",n.proxy(this.handleCheckout,this));t.on("click",".panel-body-paymentmethod .btn-add-card",n.proxy(this.handleAddCardClick,this));t.on("click",".trips-upsell input[type=checkbox]",n.proxy(this.countChecked,this));t.on("mouseenter click",".tool-tip-security-code",n.proxy(this.handleSecurtyCodeToolTip,this));t.on("change","#"+u,function(){var t=JSON.parse(n("#"+u+" option:selected").attr("data-card")).CardTypeCode;r.processCreditCardMessaging(t)});t.on("change","#"+i,function(){var t=n("#"+i).val();r.processCreditCardMessaging(t)});t.on("change","#PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode",function(){r.processCreditCardSecurityCode("PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode","divPcuCreditCardSecurityCode",!1)});t.on("blur","#PurchaseSummary_PcuBillingInfo_Selected_CardNumber",function(){var f=n("#Autodetectcard").val()=="True"?!0:!1,t,i,u;if(f==!0)if(t=n("#PurchaseSummary_PcuBillingInfo_Selected_CardNumber"),i=t.data("val-regex"),i=i.substring(0,i.indexOf("<")),t.val().length>=10)u=n("#dvcardUrl").data("cardtypeurl"),n.ajax({url:u,type:"GET",data:{firstfourDigit:n.trim(t.val()).substring(0,4),cardLength:n.trim(t.val()).length},contentType:"application/json; charset=utf-8",error:function(){},success:function(u){if(u!=null){if(u.Cardtype=="**"||u.Cardtype==""){t.addClass("input-validation-error");n('span[data-valmsg-for="PurchaseSummary.PcuBillingInfo.Selected.CardNumber"]').text(i);return}n("#PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode").val(u.Cardtype);UA.Booking.Confirmation.Upsell.selectedCardType=u.Cardtype;r.processCreditCardSecurityCode("PurchaseSummary_PcuBillingInfo_Selected_CardTypeCode","divPcuCreditCardSecurityCode",!1)}}});else{t.addClass("input-validation-error");n('span[data-valmsg-for="PurchaseSummary.PcuBillingInfo.Selected.CardNumber"]').text(i);return}});t.on("click","#pcu-terms-condition-header",function(){n(this).find(".summary-dropdown").toggleClass("summary-dropdown-expand")});t.on("keydown","#pcu-terms-condition-header",function(){n(this).attr("aria-expanded")==="false"&&n(this).find(".summary-dropdown").hasClass("summary-dropdown-expand")&&n(this).find(".summary-dropdown").removeClass("summary-dropdown-expand");n(this).attr("aria-expanded")!=="true"||n(this).find(".summary-dropdown").hasClass("summary-dropdown-expand")||n(this).find(".summary-dropdown").addClass("summary-dropdown-expand")})}}}();n(document).ready(function(){UA.Booking.Confirmation.Upsell.init()})}(jQuery);window.io_bbout_element_id="AdditionalData";window.io_enable_rip=!1;window.io_install_flash=!1;window.io_install_stm=!1;window.io_exclude_stm=0